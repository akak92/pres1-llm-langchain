version: '3.8'

services:
  mongo:
    image: mongo:7.0
    container_name: store-mongodb
    restart: unless-stopped
    environment:
      MONGO_INITDB_DATABASE: store
    ports:
      - "27025:27017"
    volumes:
      - ./Services/Mongo/init-mongo.js:/docker-entrypoint-initdb.d/init-mongo.js:ro
      - mongo_data:/data/db
    networks:
      - app-network

  llm:
    build:
      context: ./Services/LLM
      dockerfile: Dockerfile
    container_name: llm-service
    restart: unless-stopped
    environment:
      - AZURE_OPENAI_ENDPOINT=${AZURE_OPENAI_ENDPOINT}
      - AZURE_OPENAI_KEY=${AZURE_OPENAI_KEY}
      - AZURE_OPENAI_DEPLOYMENT=${AZURE_OPENAI_DEPLOYMENT}
      - AZURE_OPENAI_VERSION=${AZURE_OPENAI_VERSION}
      - MONGO_URI=mongodb://mongo:27017/store
    ports:
      - "8008:8000"
    depends_on:
      - mongo
    networks:
      - app-network

  telegram-bot:
    build:
      context: ./Services/TelegramBot
      dockerfile: Dockerfile
    container_name: telegram-bot
    restart: unless-stopped
    environment:
      - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN}
      - LLM_API_URL=http://llm:8000/chat
    depends_on:
      - llm
    networks:
      - app-network

volumes:
  mongo_data:
    driver: local

networks:
  app-network:
    driver: bridge
